"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[2538],{"../matrix-react-sdk/res/img/element-icons/cancel-rounded.svg":(e,t,s)=>{s.d(t,{G:()=>i});var o,n=s("./node_modules/react/index.js");function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])}return e},a.apply(this,arguments)}function r(e,t){return n.createElement("svg",a({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 10",role:"presentation","aria-hidden":!0,ref:t},e),o||(o=n.createElement("path",{d:"M1 1l8 8M9.001 1l-8 8",stroke:"currentColor",strokeWidth:1.6,strokeLinecap:"round"})))}var i=n.forwardRef(r)},"../matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx":(e,t,s)=>{s.d(t,{U:()=>u});var o=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/extends.js"),n=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),a=s("./node_modules/react/index.js"),r=s("../matrix-react-sdk/node_modules/classnames/index.js"),i=s.n(r),c=s("../matrix-react-sdk/src/components/views/elements/AccessibleTooltipButton.tsx"),l=s("../matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx"),m=s("../matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx");const d=["title","children","className","iconClassName","inputRef"],u=e=>{let{title:t,children:s,className:r,iconClassName:u,inputRef:p}=e,h=(0,n.c)(e,d);return!!(0,a.useContext)(l.wj)?a.createElement(m.iW,(0,o.c)({},h,{iconClassName:u,label:t,inputRef:p})):a.createElement(c.c,(0,o.c)({},h,{title:t,className:i()(r,u),ref:p}),s)}},"../matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx":(e,t,s)=>{s.d(t,{_:()=>u});var o=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/extends.js"),n=s("../matrix-react-sdk/node_modules/classnames/index.js"),a=s.n(n),r=s("./node_modules/react/index.js"),i=s("../matrix-react-sdk/src/languageHandler.tsx"),c=s("../matrix-react-sdk/src/components/structures/ContextMenu.tsx"),l=s("../matrix-react-sdk/src/components/views/emojipicker/EmojiPicker.tsx"),m=s("../matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),d=s("../matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx");function u({addEmoji:e,menuPosition:t,className:s}){const n=(0,r.useContext)(d.wj),[u,p,h,_]=(0,c.YR)();let x=null;if(u&&p.current){const s=null!=t?t:(0,c.QP)(p.current.getBoundingClientRect()),a=()=>{_(),null==n||n()};x=r.createElement(c.cp,(0,o.c)({},s,{onFinished:a,managed:!1}),r.createElement(l.cp,{onChoose:e,onFinished:a}))}const g=a()("mx_EmojiButton",s,{mx_EmojiButton_highlight:u});return r.createElement(r.Fragment,null,r.createElement(m.U,{className:g,iconClassName:"mx_EmojiButton_icon",onClick:h,title:(0,i._t)("common|emoji"),inputRef:p}),x)}},"../matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx":(e,t,s)=>{s.d(t,{wj:()=>xe,cp:()=>Pe});var o=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/extends.js"),a=s("../matrix-react-sdk/node_modules/classnames/index.js"),r=s.n(a),i=s("../matrix-js-sdk/src/matrix.ts"),c=s("./node_modules/react/index.js"),l=s("../matrix-react-sdk/src/languageHandler.tsx"),m=s("../matrix-react-sdk/src/components/views/elements/AccessibleTooltipButton.tsx"),d=s("../matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),u=s("../matrix-react-sdk/src/dispatcher/dispatcher.ts"),p=s("../matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx"),h=s("../matrix-react-sdk/src/components/structures/ContextMenu.tsx"),_=s("../matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),x=s("../matrix-react-sdk/node_modules/maplibre-gl/dist/maplibre-gl.js"),g=s.n(x),v=s("../matrix-js-sdk/src/logger.ts"),k=s("../matrix-react-sdk/src/Modal.tsx"),C=s("../matrix-react-sdk/src/utils/WellKnownUtils.ts"),E=s("../matrix-react-sdk/src/utils/beacon/index.ts"),y=s("../matrix-react-sdk/src/utils/location/index.ts"),b=s("../matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),f=s("../matrix-react-sdk/src/components/views/location/MapError.tsx"),w=s("../matrix-react-sdk/src/DateUtils.ts"),M=s("../matrix-react-sdk/src/components/views/elements/Dropdown.tsx");const S={fifteenMins:9e5,oneHour:36e5,eightHours:288e5},N=S.fifteenMins,P=e=>(0,l._t)("location_sharing|live_share_button",{duration:(0,w.AD)(e)}),L=({timeout:e,onChange:t})=>{const s=Object.values(S).map((e=>({key:e.toString(),duration:e,label:P(e)})));Object.values(S).includes(e)||s.push({key:e.toString(),duration:e,label:P(e)});return c.createElement(M.c,{id:"live-duration",label:P(e),value:e.toString(),onOptionChange:e=>{t(+e)},className:"mx_LiveDurationDropdown"},s.map((({key:e,label:t})=>c.createElement("div",{key:e},t))))};var T=s("../matrix-react-sdk/src/components/views/dialogs/QuestionDialog.tsx"),U=s("../matrix-react-sdk/src/SdkConfig.ts"),B=s("../matrix-react-sdk/src/stores/OwnBeaconStore.ts"),I=s("../matrix-react-sdk/src/utils/local-room.ts");let j=function(e){return e.Own="Own",e.Pin="Pin",e.Live="Live",e}({});const O=(e,t,s)=>{const{modalParams:o,errorMessage:n}="M_FORBIDDEN"===e.errcode?(e=>{const t=e===j.Live?"Insufficient permissions to start sharing your live location":"Insufficient permissions to send your location";return{modalParams:{title:(0,l._t)("location_sharing|error_no_perms_title"),description:(0,l._t)("location_sharing|error_no_perms_description"),button:(0,l._t)("action|ok"),hasCancelButton:!1,onFinished:()=>{}},errorMessage:t}})(s):((e,t)=>{const s=e===j.Live?"We couldn't start sharing your live location":"We couldn't send your location";return{modalParams:{title:(0,l._t)("location_sharing|error_send_title"),description:(0,l._t)("location_sharing|error_send_description",{brand:U.cp.get().brand}),button:(0,l._t)("action|try_again"),cancelButton:(0,l._t)("action|cancel"),onFinished:e=>{e&&t()}},errorMessage:s}})(s,t);v.Q.error(n,e),k.cp.createDialog(T.c,o)};var R=s("../matrix-react-sdk/src/components/views/location/Marker.tsx");const D=e=>e===j.Own||e===j.Live;class A extends c.Component{constructor(e){super(e),(0,o.c)(this,"context",void 0),(0,o.c)(this,"map",void 0),(0,o.c)(this,"geolocate",void 0),(0,o.c)(this,"marker",void 0),(0,o.c)(this,"getMarkerId",(()=>"mx_MLocationPicker_marker")),(0,o.c)(this,"addMarkerToMap",(()=>{var e;this.marker=new(g().Marker)({element:null!==(e=document.getElementById(this.getMarkerId()))&&void 0!==e?e:void 0,anchor:"bottom",offset:[0,-1]}).setLngLat(new(g().LngLat)(0,0)).addTo(this.map)})),(0,o.c)(this,"updateStyleUrl",(e=>{var t;const s=null===(t=(0,C.sD)(e))||void 0===t?void 0:t.map_style_url;var o;s&&(null===(o=this.map)||void 0===o||o.setStyle(s))})),(0,o.c)(this,"onGeolocate",(e=>{var t;this.marker||this.addMarkerToMap(),this.setState({position:(0,E.OT)(e)}),null===(t=this.marker)||void 0===t||t.setLngLat(new(g().LngLat)(e.coords.longitude,e.coords.latitude))})),(0,o.c)(this,"onClick",(e=>{var t;this.marker||this.addMarkerToMap(),null===(t=this.marker)||void 0===t||t.setLngLat(e.lngLat),this.setState({position:{timestamp:Date.now(),latitude:e.lngLat.lat,longitude:e.lngLat.lng}})})),(0,o.c)(this,"onGeolocateError",(e=>{var t;(v.Q.error("Could not fetch location",e),D(this.props.shareType)&&(this.props.onFinished(),k.cp.createDialog(p.c,{title:(0,l._t)("location_sharing|error_fetch_location"),description:(0,y.Ul)(e.code)})),this.geolocate)&&(null===(t=this.map)||void 0===t||t.removeControl(this.geolocate))})),(0,o.c)(this,"onTimeoutChange",(e=>{this.setState({timeout:e})})),(0,o.c)(this,"onOk",(()=>{const{timeout:e,position:t}=this.state;this.props.onChoose(t?{uri:(0,E.Oc)(t),timestamp:t.timestamp,timeout:e}:{timeout:e}),this.props.onFinished()})),this.state={position:void 0,timeout:N,error:void 0}}componentDidMount(){this.context.on(i.ClientEvent.ClientWellKnown,this.updateStyleUrl);try{if(this.map=new(g().Map)({container:"mx_LocationPicker_map",style:(0,y.K8)(this.context),center:[0,0],zoom:1}),this.geolocate=new(g().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1}),this.map.addControl(this.geolocate),this.map.on("error",(e=>{v.Q.error("Failed to load map: check map_style_url in config.json has a valid URL and API key",e.error),this.setState({error:y.wF.MapStyleUrlNotReachable})})),this.map.on("load",(()=>{var e;null===(e=this.geolocate)||void 0===e||e.trigger()})),this.geolocate.on("error",this.onGeolocateError),D(this.props.shareType)&&this.geolocate.on("geolocate",this.onGeolocate),this.props.shareType===j.Pin){const e=new(g().NavigationControl)({showCompass:!1,showZoom:!0});this.map.addControl(e,"bottom-right"),this.map.on("click",this.onClick)}}catch(e){v.Q.error("Failed to render map",e);const t=null==e?void 0:e.message;let s;s=t===y.wF.MapStyleUrlNotConfigured?y.wF.MapStyleUrlNotConfigured:t.includes("Failed to initialize WebGL")?y.wF.WebGLNotEnabled:y.wF.Default,this.setState({error:s})}}componentWillUnmount(){var e,t,s;null===(e=this.geolocate)||void 0===e||e.off("error",this.onGeolocateError),null===(t=this.geolocate)||void 0===t||t.off("geolocate",this.onGeolocate),null===(s=this.map)||void 0===s||s.off("click",this.onClick),this.context.off(i.ClientEvent.ClientWellKnown,this.updateStyleUrl)}render(){return this.state.error?c.createElement("div",{className:"mx_LocationPicker mx_LocationPicker_hasError"},c.createElement(f.e,{error:this.state.error,onFinished:this.props.onFinished})):c.createElement("div",{className:"mx_LocationPicker"},c.createElement("div",{id:"mx_LocationPicker_map"}),this.props.shareType===j.Pin&&c.createElement("div",{className:"mx_LocationPicker_pinText"},c.createElement("span",null,this.state.position?(0,l._t)("location_sharing|click_move_pin"):(0,l._t)("location_sharing|click_drop_pin"))),c.createElement("div",{className:"mx_LocationPicker_footer"},c.createElement("form",{onSubmit:this.onOk},this.props.shareType===j.Live&&c.createElement(L,{onChange:this.onTimeoutChange,timeout:this.state.timeout}),c.createElement(b.c,{type:"submit",element:"button",kind:"primary",className:"mx_LocationPicker_submitButton",disabled:!this.state.position,onClick:this.onOk},(0,l._t)("location_sharing|share_button")))),c.createElement("div",{id:this.getMarkerId()},!!this.marker&&c.createElement(R.c,{roomMember:D(this.props.shareType)?this.props.sender:void 0,useMemberColor:this.props.shareType===j.Live})))}}(0,o.c)(A,"contextType",_.cp);const F=A;var G=s("../matrix-react-sdk/src/settings/SettingsStore.ts"),W=s("../matrix-react-sdk/res/img/element-icons/caret-left.svg"),H=s("../matrix-react-sdk/res/img/element-icons/cancel-rounded.svg");const z=({onBack:e,onCancel:t,displayBack:s})=>c.createElement("div",{className:"mx_ShareDialogButtons"},s&&c.createElement(b.c,{className:"mx_ShareDialogButtons_button left","aria-label":(0,l._t)("action|back"),onClick:e,element:"button"},c.createElement(W.G,{className:"mx_ShareDialogButtons_button-icon"})),c.createElement(b.c,{className:"mx_ShareDialogButtons_button right","aria-label":(0,l._t)("action|close"),onClick:t,element:"button"},c.createElement(H.G,{className:"mx_ShareDialogButtons_button-icon"})));var K=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),Q=s("../matrix-react-sdk/src/stores/OwnProfileStore.ts"),Y=s("../matrix-react-sdk/src/components/views/avatars/BaseAvatar.tsx"),V=s("../matrix-react-sdk/src/components/views/typography/Heading.tsx"),q=s("../matrix-react-sdk/res/img/element-icons/location.svg"),$=s("../matrix-react-sdk/src/components/views/beacon/StyledLiveBeaconIcon.tsx");const Z=["onClick","label","shareType"],J=()=>{var e,t;const s=(0,c.useContext)(_.cp).getSafeUserId(),o=null!==(e=Q._.instance.displayName)&&void 0!==e?e:void 0,n="36px",a=null!==(t=Q._.instance.getHttpAvatarUrl(parseInt(n,10)))&&void 0!==t?t:void 0;return c.createElement("div",{className:`mx_ShareType_option-icon ${j.Own}`},c.createElement(Y.c,{idName:s,name:o,url:a,size:n,className:"mx_UserMenu_userAvatar_BaseAvatar"}))},X=e=>{let{onClick:t,label:s,shareType:o}=e,a=(0,K.c)(e,Z);return c.createElement(b.c,(0,n.c)({element:"button",className:"mx_ShareType_option",onClick:null!=t?t:null},a),o===j.Own&&c.createElement(J,null),o===j.Pin&&c.createElement(q.G,{className:`mx_ShareType_option-icon ${j.Pin}`}),o===j.Live&&c.createElement($.c,{className:`mx_ShareType_option-icon ${j.Live}`}),s)},ee=({setShareType:e,enabledShareTypes:t})=>{const s={[j.Own]:(0,l._t)("location_sharing|share_type_own"),[j.Live]:(0,l._t)("location_sharing|share_type_live"),[j.Pin]:(0,l._t)("location_sharing|share_type_pin")};return c.createElement("div",{className:"mx_ShareType"},c.createElement(q.G,{className:"mx_ShareType_badge"}),c.createElement(V.c,{className:"mx_ShareType_heading",size:"3"},(0,l._t)("location_sharing|share_type_prompt")),c.createElement("div",{className:"mx_ShareType_wrapper_options"},t.map((t=>c.createElement(X,{key:t,onClick:()=>e(t),label:s[t],shareType:t})))))};var te=s("../matrix-react-sdk/src/components/views/elements/LabelledToggleSwitch.tsx");const se=({onSubmit:e})=>{const[t,s]=(0,c.useState)(!1);return c.createElement("div",{className:"mx_EnableLiveShare"},c.createElement($.c,{className:"mx_EnableLiveShare_icon"}),c.createElement(V.c,{className:"mx_EnableLiveShare_heading",size:"3"},(0,l._t)("location_sharing|live_enable_heading")),c.createElement("p",{className:"mx_EnableLiveShare_description"},(0,l._t)("location_sharing|live_enable_description")),c.createElement(te.c,{value:t,onChange:s,label:(0,l._t)("location_sharing|live_toggle_label")}),c.createElement(b.c,{className:"mx_EnableLiveShare_button",element:"button",kind:"primary",onClick:e,disabled:!t},(0,l._t)("action|ok")))};var oe=s("../matrix-react-sdk/src/hooks/useSettings.ts"),ne=s("../matrix-react-sdk/src/settings/SettingLevel.ts");const ae=({menuPosition:e,onFinished:t,sender:s,roomId:o,openMenu:a,relation:r})=>{const m=(0,c.useContext)(_.cp),d=(e=>{const t=[j.Own];return e||t.push(j.Live),t.push(j.Pin),t})(r),u=(0,oe.A)("feature_location_share_live"),p=d.length>1,[x,g]=(0,c.useState)(p?void 0:j.Own),v=Q._.instance.displayName,k=m.getSafeUserId(),C=x===j.Live?((e,t,s,o)=>async({timeout:e})=>{const n=(0,l._t)("location_sharing|live_description",{displayName:s});try{await B.a.instance.createLiveBeacon(t,i.ContentHelpers.makeBeaconInfoContent(null!=e?e:3e5,!0,n,i.LocationAssetType.Self))}catch(e){O(e,o,j.Live)}})(0,o,v||k,a):((e,t,s,o,n)=>async({uri:a,timestamp:r})=>{if(a)try{const n=(null==o?void 0:o.rel_type)===i.THREAD_RELATION_TYPE.name&&(null==o?void 0:o.event_id)||null,c=s===j.Pin?i.LocationAssetType.Pin:i.LocationAssetType.Self,l=i.ContentHelpers.makeLocationContent(void 0,a,r,void 0,c);await(0,I.m)(t,(t=>e.sendMessage(t,n,l)),e)}catch(e){O(e,n,s)}})(m,o,null!=x?x:j.Own,r,a),E=x===j.Live&&!u;return c.createElement(h.cp,(0,n.c)({},e,{onFinished:t,managed:!1}),c.createElement("div",{className:"mx_LocationShareMenu"},E&&c.createElement(se,{onSubmit:()=>{G.c.setValue("feature_location_share_live",null,ne.m.DEVICE,!0)}}),!E&&!!x&&c.createElement(F,{sender:s,shareType:x,onChoose:C,onFinished:t}),!x&&c.createElement(ee,{setShareType:g,enabledShareTypes:d}),c.createElement(z,{displayBack:!!x&&p,onBack:()=>g(void 0),onCancel:t})))},re=({roomId:e,sender:t,menuPosition:s,relation:o})=>{const n=(0,c.useContext)(xe),[a,i,m,u]=(0,h.YR)(),p=e=>{u(e),null==n||n()};let _=null;if(a){var x;const n=null!==(x=null!=s?s:i.current&&(0,h.QP)(i.current.getBoundingClientRect()))&&void 0!==x?x:{};_=c.createElement(ae,{menuPosition:n,onFinished:p,sender:t,roomId:e,openMenu:m,relation:o})}const g=r()("mx_MessageComposer_button",{mx_MessageComposer_button_highlight:a});return c.createElement(c.Fragment,null,c.createElement(d.U,{className:g,iconClassName:"mx_MessageComposer_location",onClick:m,title:(0,l._t)("common|location"),inputRef:i}),_)};var ie=s("../matrix-react-sdk/src/components/views/elements/PollCreateDialog.tsx"),ce=s("../matrix-react-sdk/src/MatrixClientPeg.ts"),le=s("../matrix-react-sdk/src/ContentMessages.ts"),me=s("../matrix-react-sdk/src/contexts/RoomContext.ts"),de=s("../matrix-react-sdk/src/hooks/useDispatcher.ts"),ue=s("../matrix-react-sdk/src/utils/BrowserWorkarounds.ts"),pe=s("../matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx"),he=s("../matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx"),_e=s("../matrix-react-sdk/src/utils/arrays.ts");const xe=(0,c.createContext)(null);function ge(e){return c.createElement(he._,{key:"emoji_button",addEmoji:e.addEmoji,menuPosition:e.menuPosition,className:"mx_MessageComposer_button"})}function ve(){return c.createElement(Ee,{key:"controls_upload"})}const ke=(0,c.createContext)(null),Ce=({roomId:e,relation:t,children:s})=>{const o=(0,c.useContext)(_.cp),n=(0,c.useContext)(me.cp),a=(0,c.useRef)(null),r=()=>{var e;null!=o&&o.isGuest()?u.cp.dispatch({action:"require_registration"}):null===(e=a.current)||void 0===e||e.click()};(0,de.S)(u.cp,(e=>{n.timelineRenderingType===e.context&&"upload_file"===e.action&&r()}));return c.createElement(ke.Provider,{value:r},s,c.createElement("input",{ref:a,type:"file",style:{display:"none"},multiple:!0,onClick:ue.m,onChange:s=>{var a;0!==(null===(a=s.target.files)||void 0===a?void 0:a.length)&&(le.cp.sharedInstance().sendContentListToRoom(Array.from(s.target.files),e,t,o,n.timelineRenderingType),s.target.value="")}}))},Ee=()=>{const e=(0,c.useContext)(xe),t=(0,c.useContext)(ke);return c.createElement(d.U,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_upload",onClick:()=>{null==t||t(),null==e||e()},title:(0,l._t)("common|attachment")})};function ye(e){return e.showStickersButton?c.createElement(d.U,{id:"stickersButton",key:"controls_stickers",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_stickers",onClick:()=>e.setStickerPickerOpen(!e.isStickerPickerOpen),title:e.isStickerPickerOpen?(0,l._t)("composer|close_sticker_picker"):(0,l._t)("common|sticker")}):null}const be=e=>e.showVoiceBroadcastButton?c.createElement(d.U,{key:"start_voice_broadcast",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceBroadcast",onClick:e.onStartVoiceBroadcastClick,title:(0,l._t)("voice_broadcast|action")}):null;function fe(e,t){return t?null:c.createElement(d.U,{key:"voice_message_send",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceMessage",onClick:e.onRecordStartEndClick,title:(0,l._t)("composer|voice_message_button")})}function we(e,t){return c.createElement(Me,{key:"polls",room:e,relation:t})}class Me extends c.PureComponent{constructor(...e){super(...e),(0,o.c)(this,"context",void 0),(0,o.c)(this,"onCreateClick",(()=>{var e;null===(e=this.context)||void 0===e||e.call(this);if(this.props.room.currentState.maySendEvent(i.M_POLL_START.name,ce.W.safeGet().getSafeUserId())){var t;const e=(null===(t=this.props.relation)||void 0===t?void 0:t.rel_type)===i.THREAD_RELATION_TYPE.name?this.props.relation.event_id:void 0;k.cp.createDialog(ie.c,{room:this.props.room,threadId:e},"mx_CompoundDialog",!1,!0)}else k.cp.createDialog(p.c,{title:(0,l._t)("composer|poll_button_no_perms_title"),description:(0,l._t)("composer|poll_button_no_perms_description")})}))}render(){var e;return(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===i.THREAD_RELATION_TYPE.name?null:c.createElement(d.U,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_poll",onClick:this.onCreateClick,title:(0,l._t)("composer|poll_button")})}}function Se(e,t,s){const o=t.getMember(s.getSafeUserId());return e.showLocationButton&&o?c.createElement(re,{key:"location",roomId:t.roomId,relation:e.relation,sender:o,menuPosition:e.menuPosition}):null}function Ne({isRichTextEnabled:e,onClick:t}){const s=e?(0,l._t)("composer|mode_plain"):(0,l._t)("composer|mode_rich_text");return c.createElement(d.U,{className:"mx_MessageComposer_button",iconClassName:r()({mx_MessageComposer_plain_text:!e,mx_MessageComposer_rich_text:e}),onClick:t,title:s})}(0,o.c)(Me,"contextType",xe);const Pe=e=>{const t=(0,c.useContext)(_.cp),{room:s,narrow:o}=(0,c.useContext)(me.cp),a=(0,oe.K)("feature_wysiwyg_composer");if(!t||!s||e.haveRecording)return null;let i,d;o?(i=[a?c.createElement(Ne,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):ge(e)],d=[ve(),ye(e),fe(e,o),be(e),e.showPollsButton?we(s,e.relation):null,Se(e,s,t)]):(i=[a?c.createElement(Ne,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):ge(e),ve()],d=[ye(e),fe(e,o),be(e),e.showPollsButton?we(s,e.relation):null,Se(e,s,t)]),i=(0,_e.em)(i),d=(0,_e.em)(d);const u=r()({mx_MessageComposer_button:!0,mx_MessageComposer_buttonMenu:!0,mx_MessageComposer_closeButtonMenu:e.isMenuOpen});return c.createElement(Ce,{roomId:s.roomId,relation:e.relation},i,d.length>0&&c.createElement(m.c,{className:u,onClick:e.toggleButtonMenu,title:(0,l._t)("quick_settings|sidebar_settings")}),e.isMenuOpen&&c.createElement(pe.cp,(0,n.c)({onFinished:e.toggleButtonMenu},e.menuPosition,{wrapperClassName:"mx_MessageComposer_Menu",compact:!0}),c.createElement(xe.Provider,{value:e.toggleButtonMenu},c.createElement(pe.Wk,null,d))))}},"../matrix-react-sdk/src/stores/OwnProfileStore.ts":(e,t,s)=>{s.d(t,{_:()=>h});var o,n=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../matrix-js-sdk/src/matrix.ts"),r=s("../matrix-react-sdk/node_modules/lodash/lodash.js"),i=s("../matrix-react-sdk/src/stores/AsyncStoreWithClient.ts"),c=s("../matrix-react-sdk/src/dispatcher/dispatcher.ts"),l=s("../matrix-react-sdk/src/MatrixClientPeg.ts"),m=s("../matrix-react-sdk/src/languageHandler.tsx"),d=s("../matrix-react-sdk/src/customisations/Media.ts");const u="mx_profile_displayname",p="mx_profile_avatar_url";class h extends i.k{constructor(){super(c.cp,{displayName:window.localStorage.getItem(u)||void 0,avatarUrl:window.localStorage.getItem(p)||void 0}),(0,n.c)(this,"monitoredUser",null),(0,n.c)(this,"onProfileUpdate",(0,r.throttle)((async()=>{if(!this.matrixClient)return;let e={displayname:void 0,avatar_url:void 0};try{e=await this.matrixClient.getProfileInfo(this.matrixClient.getSafeUserId())}catch(e){if(!(e instanceof a.MatrixError)||"M_NOT_FOUND"!==e.errcode)throw e}e.displayname?window.localStorage.setItem(u,e.displayname):window.localStorage.removeItem(u),e.avatar_url?window.localStorage.setItem(p,e.avatar_url):window.localStorage.removeItem(p),await this.updateState({displayName:e.displayname,avatarUrl:e.avatar_url,fetchedAt:Date.now()})}),200,{trailing:!0,leading:!0})),(0,n.c)(this,"onStateEvents",(async e=>{const t=l.W.safeGet().getUserId();e.getType()===a.EventType.RoomMember&&e.getSender()===t&&e.getStateKey()===t&&await this.onProfileUpdate()}))}static get instance(){return h.internalInstance}get displayName(){return this.matrixClient?this.matrixClient.isGuest()?(0,m._t)("common|guest"):this.state.displayName?this.state.displayName:this.matrixClient.getUserId():this.state.displayName||null}get isProfileInfoFetched(){return!!this.state.fetchedAt}get avatarMxc(){return this.state.avatarUrl||null}getHttpAvatarUrl(e=0){if(!this.avatarMxc)return null;const t=(0,d.Ky)(this.avatarMxc);return!e||e<=0?t.srcHttp:t.getSquareThumbnailHttp(e)}async onNotReady(){var e;this.onProfileUpdate.cancel(),this.monitoredUser&&(this.monitoredUser.removeListener(a.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.removeListener(a.UserEvent.AvatarUrl,this.onProfileUpdate)),null===(e=this.matrixClient)||void 0===e||e.removeListener(a.RoomStateEvent.Events,this.onStateEvents),await this.reset({})}async onReady(){if(!this.matrixClient)return;const e=this.matrixClient.getSafeUserId();this.monitoredUser=this.matrixClient.getUser(e),this.monitoredUser&&(this.monitoredUser.on(a.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.on(a.UserEvent.AvatarUrl,this.onProfileUpdate)),this.matrixClient.on(a.RoomStateEvent.Events,this.onStateEvents),await this.onProfileUpdate()}async onAction(e){}}o=h,(0,n.c)(h,"internalInstance",(()=>{const e=new o;return e.start(),e})())}}]);
//# sourceMappingURL=2538.js.map