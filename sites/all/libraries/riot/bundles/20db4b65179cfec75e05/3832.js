"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[3832],{"../matrix-react-sdk/src/async-components/views/dialogs/security/CreateKeyBackupDialog.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var a=s("../matrix-react-sdk/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("./node_modules/react/index.js"),n=s("../matrix-js-sdk/src/logger.ts"),c=s("../matrix-react-sdk/src/MatrixClientPeg.ts"),i=s("../matrix-react-sdk/src/languageHandler.tsx"),o=s("../matrix-react-sdk/src/SecurityManager.ts"),l=s("../matrix-react-sdk/src/components/views/elements/Spinner.tsx"),u=s("../matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),p=s("../matrix-react-sdk/src/components/views/elements/DialogButtons.tsx"),h=function(e){return e.BackingUp="backing_up",e.Done="done",e}(h||{});class d extends r.PureComponent{constructor(e){super(e),(0,a.c)(this,"createBackup",(async()=>{this.setState({error:void 0});const e=c.W.safeGet();try{await e.hasSecretStorageKey()?await(0,o.Ml)((async()=>{const t=e.getCrypto();if(!t)throw new Error("End-to-end encryption is disabled - unable to create backup.");await e.secretStorage.get("m.megolm_backup.v1"),await t.resetKeyBackup()})):await(0,o.c5)((async()=>{})),this.setState({phase:h.Done})}catch(e){n.Q.error("Error creating key backup",e),this.setState({error:!0})}})),(0,a.c)(this,"onCancel",(()=>{this.props.onFinished(!1)})),(0,a.c)(this,"onDone",(()=>{this.props.onFinished(!0)})),this.state={phase:h.BackingUp,passPhrase:"",passPhraseValid:!1,passPhraseConfirm:"",copied:!1,downloaded:!1}}componentDidMount(){this.createBackup()}renderBusyPhase(){return r.createElement("div",null,r.createElement(l.c,null))}renderPhaseDone(){return r.createElement("div",null,r.createElement("p",null,(0,i._t)("settings|key_backup|backup_in_progress")),r.createElement(p.c,{primaryButton:(0,i._t)("action|ok"),onPrimaryButtonClick:this.onDone,hasCancel:!1}))}titleForPhase(e){switch(e){case h.BackingUp:return(0,i._t)("settings|key_backup|backup_starting");case h.Done:return(0,i._t)("settings|key_backup|backup_success");default:return(0,i._t)("settings|key_backup|create_title")}}render(){let e;if(this.state.error)e=r.createElement("div",null,r.createElement("p",null,(0,i._t)("settings|key_backup|cannot_create_backup")),r.createElement(p.c,{primaryButton:(0,i._t)("action|retry"),onPrimaryButtonClick:this.createBackup,hasCancel:!0,onCancel:this.onCancel}));else switch(this.state.phase){case h.BackingUp:e=this.renderBusyPhase();break;case h.Done:e=this.renderPhaseDone()}return r.createElement(u.c,{className:"mx_CreateKeyBackupDialog",onFinished:this.props.onFinished,title:this.titleForPhase(this.state.phase),hasCancel:[h.Done].includes(this.state.phase)},r.createElement("div",null,e))}}}}]);
//# sourceMappingURL=3832.js.map